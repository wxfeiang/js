<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
</head>

<body>
    <script>
        var arr = [
            { id: 56, pid: 62, name: 'sssss' },
            { id: 81, pid: 80 },
            { id: 74, pid: null },
            { id: 76, pid: 80 },
            { id: 63, pid: 62 },
            { id: 80, pid: 86 },
            { id: 87, pid: 86 },
            { id: 62, pid: 74 },
            { id: 86, pid: 74 },
            { id: 12, pid: null },
            { id: 44, pid: 12 },
            { id: 13, pid: 12 }
        ]
        //  ç¬¬ä¸€æ¬¡ æ”¹å˜æˆæ ‘
        function gettree(arr, id, list) {
            for (let item of arr) {
                if (item.pid == id) {
                    list.push(item)
                }
            }
            for (let i of list) {
                i.children = []
                gettree(arr, i.id, i.children)
                if (i.children.length == 0) {
                    delete i.children
                }
            }

            return list
        }

        var res = gettree(arr, null, [])
        console.log(res)
        console.log(JSON.stringify(res))

        //  æ›´ä¼˜
        let arr3 = [
            { id: 1, name: 'éƒ¨é—¨1', pid: 0 },
            { id: 2, name: 'éƒ¨é—¨2', pid: 1 },
            { id: 3, name: 'éƒ¨é—¨3', pid: 1 },
            { id: 4, name: 'éƒ¨é—¨4', pid: 3 },
            { id: 5, name: 'éƒ¨é—¨5', pid: 4 }
        ]
        var arr4 = [
            { id: 56, pid: 62 },
            { id: 81, pid: 80 },
            { id: 74, pid: null },
            { id: 76, pid: 80 },
            { id: 63, pid: 62 },
            { id: 80, pid: 86 },
            { id: 87, pid: 86 },
            { id: 62, pid: 74 },
            { id: 86, pid: 74 },
            { id: 12, pid: null },
            { id: 44, pid: 12 },
            { id: 13, pid: 12 }
        ]

        function arrayToTree(items) {
            const result = [] // å­˜æ”¾ç»“æœé›†
            const itemMap = {} //
            for (const item of items) {
                const id = item.id
                const pid = item.pid

                if (!itemMap[id]) {
                    itemMap[id] = {
                        children: []
                    }
                }

                itemMap[id] = {
                    ...item,
                    children: itemMap[id]['children']
                }

                const treeItem = itemMap[id]

                if (pid === 0 || pid == '' || !pid) {
                    result.push(treeItem)
                } else {
                    if (!itemMap[pid]) {
                        itemMap[pid] = {
                            children: []
                        }
                    }
                    itemMap[pid].children.push(treeItem)
                }
            }
            return result
        }

        console.log('â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦^_^â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦')
        console.log(arrayToTree(arr3))
        var res0 = arrayToTree(arr4)
        console.log(res0, 'res0----')

        //  è¿˜åŸæ‰å¹³åŒ–

        var newArr = [] //æ–°å»ºä¸€ä¸ªæ•°æ®ï¼Œç”¨äºå­˜å‚¨æ‰å¹³åŒ–åŒ–åçš„æ•°ç»„
        function flatData(arr) {
            arr.forEach((item) => {
                newArr.push(item)
                item.children && item.children.length > 0 ? flatData(item.children) : ''
                delete item.children
                //  item.children = ''    //è‹¥æ˜¯æ‰å¹³åŒ–åçš„æ•°ç»„é¡»è¦æ˜¾ç¤ºçˆ¶å­å±‚çº§ï¼Œèƒ½å¤ŸæŠŠè¿™ä¸€é¡¹åˆ é™¤
            })
        }
        var naar2 = []
        function flatData2(arr) {
            arr.forEach((item) => {
                if (item.children && item.children.length > 0) {
                    flatData2(item)
                } else {
                    naar2.push(item)
                }
            })
        }
        flatData(res0)
        console.log(newArr, 'newArr', naar2)

        //åˆ©ç”¨reduce é‡æ–°æ‰å¹³åŒ–

        let trees = [
            {
                id: 74,
                pid: null,
                children: [
                    {
                        id: 62,
                        pid: 74,
                        children: [
                            { id: 56, pid: 62, name: 'sssss' },
                            { id: 63, pid: 62 }
                        ]
                    },
                    {
                        id: 86,
                        pid: 74,
                        children: [
                            {
                                id: 80,
                                pid: 86,
                                children: [
                                    { id: 81, pid: 80 },
                                    { id: 76, pid: 80 }
                                ]
                            },
                            { id: 87, pid: 86 }
                        ]
                    }
                ]
            },
            {
                id: 12,
                pid: null,
                children: [
                    { id: 44, pid: 12 },
                    { id: 13, pid: 12 }
                ]
            }
        ]
        trees.reduce((prev, cur) => {
            console.log('ğŸ¹[prev, cur]:', prev);

        })
    </script>
</body>

</html>