<!--
 * @Author: wxfeiang
 * @Description:
 * @Date: 2022-12-05 22:19:04
 * @LastEditTime: 2023-12-28 22:26:09
 * @FilePath: /js/element2-demo/uploadFrom.html
-->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>upload</title>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">


</head>

<body>
    <div id="app">
        <div style="width: 500px; margin: 300px auto;border:1px solid #ccc;padding: 40px;">
            {{ruleForm.name}}

            <el-form :model="ruleForm" :rules="rules" ref="ruleForm" label-width="100px" class="demo-ruleForm">
                <el-form-item label="‰∏ä‰º†ÂõæÁâá" prop="name">

                    <el-upload action="http://localhost:3001/v1/base/uploadLocal" list-type="picture-card"
                        :on-success="uploadSess" :file-list="fileList" :limit="3" :on-preview="handlePictureCardPreview"
                        :on-remove="handleRemove">
                        <i class="el-icon-plus"></i>
                    </el-upload>


                </el-form-item>
            </el-form>
            <el-button type="primary" @click="submitForm('ruleForm')">Á´ãÂç≥ÂàõÂª∫</el-button>
            <el-button @click="resetForm('ruleForm')">ÈáçÁΩÆ</el-button>
            <el-dialog :visible.sync="dialogVisible">
                <img width="100%" :src="dialogImageUrl" alt="">
            </el-dialog>
        </div>
    </div>

    <script src="https://cdn.bootcdn.net/ajax/libs/vue/2.6.13/vue.js"></script>

    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <script>

        new Vue({
            el: '#app',
            data() {
                return {
                    dialogImageUrl: '',
                    dialogVisible: false,
                    ruleForm: {},
                    rules: {
                        name: [
                            { required: true, message: 'ËØ∑‰∏ä‰º†ÂõæÁâá', trigger: ['blur', "change"] },
                        ],
                    },
                    fileList: [
                    ]

                };
            },
            watch: {
                'ruleForm.name': {
                    handler(newVal) {
                        if (newVal.length) {
                            this.$refs['ruleForm'].clearValidate(['name'])
                        }
                    },
                    deep: true
                }
            },

            methods: {

                handlePictureCardPreview(file) {
                    this.dialogImageUrl = file.url;
                    this.dialogVisible = true;
                },
                submitForm(formName) {
                    this.$refs[formName].validate((valid) => {
                        console.log('üç¨', this.ruleForm);
                        if (valid) {
                            alert('submit!');
                        } else {
                            console.log('error submit!!');
                            return false;
                        }
                    });
                },
                resetForm(formName) {
                    this.$refs[formName].resetFields();
                },
                uploadSess(response, file, fileList) {
                    this.fileList.push({
                        name: response.data.url,
                        url: response.data.base + response.data.url
                    })
                    this.ruleForm.name = this.fileList.map(i => i.url).join(',');
                    // this.$refs['ruleForm'].clearValidate()
                    // this.$refs['ruleForm'].validateField('name');

                },
                handleRemove(file, fileList) {
                    console.log('üçºÔ∏è[fileList]:', fileList);
                    console.log('ü••[file]:', file);

                    this.ruleForm.name = fileList.map(i => i.url).join(',');
                    console.log('üçà[this.ruleForm.name]:', this.ruleForm.name);
                },
            }
        })

    </script>


</body>

</html>